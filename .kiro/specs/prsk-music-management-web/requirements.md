# 要件ドキュメント

## はじめに

このドキュメントは、プロジェクトセカイ（プロセカ）の楽曲マスタデータとアーティストマスタデータを管理するためのWebページの要件を定義します。このシステムは、既存のREST APIを利用して、楽曲情報とアーティスト情報の閲覧、登録、更新、削除を行うWebインターフェースを提供します。

## 用語集

- **システム**: プロセカ楽曲・アーティスト管理Webページ
- **楽曲一覧表示**: 楽曲一覧を表示するコンポーネント
- **楽曲フォーム**: 楽曲情報の登録・編集フォームコンポーネント
- **アーティスト一覧表示**: アーティスト一覧を表示するコンポーネント
- **アーティストフォーム**: アーティスト情報の登録・編集フォームコンポーネント
- **APIクライアント**: バックエンドAPIとの通信を担当するクライアント
- **ページネーション制御**: ページネーション制御コンポーネント
- **ユーザー**: システムを利用する管理者
- **楽曲レコード**: 楽曲データレコード
- **アーティストレコード**: アーティストデータレコード
- **楽曲タイプ**: 楽曲タイプ（0:オリジナル、1:3DMV、2:2DMV）

## 要件

### 要件1: 楽曲一覧表示

**ユーザーストーリー:** ユーザーとして、すべての楽曲レコードをテーブル形式で閲覧したい。そうすることで、楽曲データベースを効率的に閲覧・管理できる。

#### 受入基準

1. WHEN ユーザーが楽曲一覧ページにアクセスしたとき、THE 楽曲一覧表示 SHALL すべての楽曲レコードをテーブル形式で表示する
2. WHEN 楽曲レコードを表示するとき、THE 楽曲一覧表示 SHALL id、title、artistName、unitName、musicType、specially、lyricsName、musicName、featuring、youtubeLink フィールドを表示する
3. WHEN 楽曲一覧が20件を超えるとき、THE ページネーション制御 SHALL ページネーションコントロールを表示する
4. WHEN musicTypeを表示するとき、THE 楽曲一覧表示 SHALL 数値を読みやすいラベルに変換する（0→"オリジナル"、1→"3DMV"、2→"2DMV"）
5. WHEN youtubeLinkフィールドを表示するとき、THE 楽曲一覧表示 SHALL クリック可能なリンクとして表示する
6. WHEN　youtubeLinkフィールドは「YouTubeで見る」などのテキスト表示にしてクリックしたらモーダル表示でWebページ内で視聴できるようにする

### 要件2: 楽曲新規登録

**ユーザーストーリー:** ユーザーとして、フォームを通じて新しい楽曲レコードを登録したい。そうすることで、データベースに新しい楽曲を追加できる。

#### 受入基準

1. WHEN ユーザーが「新規登録」ボタンをクリックしたとき、THE システム SHALL 空のフィールドを持つ楽曲フォームを表示する
2. WHEN ユーザーがフォームを送信したとき、THE APIクライアント SHALL フォームデータを含むPOSTリクエストを /prsk-music に送信する
3. IF APIが201 Createdを返したとき、THEN THE システム SHALL 成功メッセージを表示し、楽曲一覧を更新する
4. IF APIが409 Conflictを返したとき、THEN THE システム SHALL 同じtitleとmusicTypeを持つ楽曲レコードが既に存在することを示すエラーメッセージを表示する
5. IF APIが400 Bad Requestを返したとき、THEN THE システム SHALL 各無効なフィールドに対する検証エラーメッセージを表示する
6. THE 楽曲フォーム SHALL 送信前にtitle、artistId、musicType、youtubeLinkフィールドが空でないことを検証する
7. THE 楽曲フォーム SHALL artistIdフィールドにドロップダウンまたは選択インターフェースを提供する
8. THE 楽曲フォーム SHALL musicTypeフィールドに選択肢（0:オリジナル、1:3DMV、2:2DMV）を持つドロップダウンを提供する
9. WHEN ユーザーがアーティスト選択ドロップダウンの横の「新規追加」ボタンをクリックしたとき、THE システム SHALL アーティスト登録モーダルを表示する
10. WHEN アーティスト登録が完了したとき、THE システム SHALL アーティスト一覧を再取得し、新規追加されたアーティストを楽曲フォームで自動選択する

### 要件3: 楽曲情報編集

**ユーザーストーリー:** ユーザーとして、既存の楽曲レコードを編集したい。そうすることで、誤った情報や古い情報を更新できる。

#### 受入基準

1. WHEN ユーザーが楽曲レコードの「編集」ボタンをクリックしたとき、THE システム SHALL 現在のレコードデータが事前入力された楽曲フォームを表示する
2. WHEN ユーザーが編集したフォームを送信したとき、THE APIクライアント SHALL 更新されたデータを含むPUTリクエストを /prsk-music/{id} に送信する
3. IF APIが200 OKを返したとき、THEN THE システム SHALL 成功メッセージを表示し、楽曲一覧を更新する
4. IF APIが404 Not Foundを返したとき、THEN THE システム SHALL 楽曲レコードが存在しないことを示すエラーメッセージを表示する
5. IF APIが409 Conflictを返したとき、THEN THE システム SHALL 同じtitleとmusicTypeを持つ別の楽曲レコードが既に存在することを示すエラーメッセージを表示する
6. IF APIが400 Bad Requestを返したとき、THEN THE システム SHALL 各無効なフィールドに対する検証エラーメッセージを表示する

### 要件4: 楽曲削除

**ユーザーストーリー:** ユーザーとして、楽曲レコードを削除したい。そうすることで、不要になった楽曲を削除できる。

#### 受入基準

1. WHEN ユーザーが楽曲レコードの「削除」ボタンをクリックしたとき、THE システム SHALL 確認ダイアログを表示する
2. WHEN ユーザーが削除を確認したとき、THE APIクライアント SHALL DELETEリクエストを /prsk-music/{id} に送信する
3. IF APIが204 No Contentを返したとき、THEN THE システム SHALL 成功メッセージを表示し、楽曲一覧を更新する
4. IF APIが404 Not Foundを返したとき、THEN THE システム SHALL 楽曲レコードが存在しないことを示すエラーメッセージを表示する
5. WHEN ユーザーが確認ダイアログで削除をキャンセルしたとき、THE システム SHALL 変更を加えずにダイアログを閉じる

### 要件5: ページネーション

**ユーザーストーリー:** ユーザーとして、楽曲レコードのページを移動したい。そうすることで、大量のデータセットを効率的に閲覧できる。

#### 受入基準

1. WHEN 楽曲一覧を取得するとき、THE APIクライアント SHALL GET /prsk-music リクエストにpageとlimitクエリパラメータを含める
2. WHEN APIがページネーションメタデータを返したとき、THE ページネーション制御 SHALL 現在のページ番号、総ページ数、総アイテム数を表示する
3. WHEN ユーザーがページ番号をクリックしたとき、THE システム SHALL 対応するページの楽曲レコードを取得して表示する
4. WHEN ユーザーが「次へ」をクリックしたとき、THE システム SHALL 利用可能な場合は次のページに移動する
5. WHEN ユーザーが「前へ」をクリックしたとき、THE システム SHALL 利用可能な場合は前のページに移動する
6. WHEN 最初のページにいるとき、THE ページネーション制御 SHALL 「前へ」ボタンを無効化する
7. WHEN 最後のページにいるとき、THE ページネーション制御 SHALL 「次へ」ボタンを無効化する

### 要件6: エラーハンドリング

**ユーザーストーリー:** ユーザーとして、操作が失敗したときに明確なエラーメッセージを見たい。そうすることで、何が問題だったのか、どう修正すればよいのかを理解できる。

#### 受入基準

1. WHEN APIが500 Internal Server Errorを返したとき、THE システム SHALL 後でもう一度試すよう求める一般的なエラーメッセージを表示する
2. WHEN APIが503 Service Unavailableを返したとき、THE システム SHALL サービスがメンテナンス中であることを示すメッセージを表示する
3. WHEN ネットワークエラーが発生したとき、THE システム SHALL 接続の問題を示すメッセージを表示する
4. WHEN APIがレスポンスボディにエラー詳細を返したとき、THE システム SHALL それらの具体的なエラーメッセージをユーザーに表示する
5. WHEN エラーが発生したとき、THE システム SHALL デバッグのためにエラー詳細をブラウザコンソールにログ出力する

### 要件7: ユーザーインターフェース

**ユーザーストーリー:** ユーザーとして、直感的でレスポンシブなユーザーインターフェースを使いたい。そうすることで、どのデバイスでも効率的に楽曲レコードを管理できる。

#### 受入基準

1. THE システム SHALL デスクトップとタブレットデバイスで動作するレスポンシブレイアウトを提供する
2. THE 楽曲一覧表示 SHALL インタラクティブな要素にホバーしたときに視覚的なフィードバックを提供する
3. WHEN フォームが送信されているとき、THE システム SHALL ローディングインジケーターを表示する
4. WHEN データが取得されているとき、THE システム SHALL 楽曲一覧表示にローディングインジケーターを表示する
5. THE システム SHALL インターフェース全体で一貫したスタイリングと間隔を使用する
6. THE システム SHALL すべてのフォームフィールドに日本語の明確なラベルを提供する

### 要件8: データ検証

**ユーザーストーリー:** ユーザーとして、送信前にシステムが入力を検証してほしい。そうすることで、無効なデータの送信を避けることができる。

#### 受入基準

1. WHEN ユーザーがtitleフィールドにデータを入力したとき、THE 楽曲フォーム SHALL 空でないことを検証する
2. WHEN ユーザーがyoutubeLinkフィールドにデータを入力したとき、THE 楽曲フォーム SHALL 有効なURL形式であることを検証する
3. WHEN ユーザーがartistIdを選択したとき、THE 楽曲フォーム SHALL 有効なアーティストが選択されていることを検証する
4. WHEN ユーザーがmusicTypeドロップダウンを表示したとき、THE 楽曲フォーム SHALL 3つの選択肢（0:オリジナル、1:3DMV、2:2DMV）を表示する
5. WHEN 検証が失敗したとき、THE 楽曲フォーム SHALL 無効なフィールドの横にインラインエラーメッセージを表示する
6. WHEN すべての必須フィールドが有効なとき、THE 楽曲フォーム SHALL 送信ボタンを有効化する
7. WHEN いずれかの必須フィールドが無効または空のとき、THE 楽曲フォーム SHALL 送信ボタンを無効化する

### 要件9: アーティスト一覧表示

**ユーザーストーリー:** ユーザーとして、すべてのアーティストレコードをテーブル形式で閲覧したい。そうすることで、アーティストデータベースを効率的に閲覧・管理できる。

#### 受入基準

1. WHEN ユーザーがアーティスト一覧ページにアクセスしたとき、THE アーティスト一覧表示 SHALL すべてのアーティストレコードをテーブル形式で表示する
2. WHEN アーティストレコードを表示するとき、THE アーティスト一覧表示 SHALL id、artistName、unitName、content フィールドを表示する
3. WHEN アーティスト一覧が20件を超えるとき、THE ページネーション制御 SHALL ページネーションコントロールを表示する
4. THE アーティスト一覧表示 SHALL 各アーティストレコードに編集と削除のアクションボタンを提供する

### 要件10: アーティスト新規登録

**ユーザーストーリー:** ユーザーとして、フォームを通じて新しいアーティストレコードを登録したい。そうすることで、データベースに新しいアーティストを追加できる。

#### 受入基準

1. WHEN ユーザーが「新規登録」ボタンをクリックしたとき、THE システム SHALL 空のフィールドを持つアーティストフォームを表示する
2. WHEN ユーザーがフォームを送信したとき、THE APIクライアント SHALL フォームデータを含むPOSTリクエストを /artists に送信する
3. IF APIが201 Createdを返したとき、THEN THE システム SHALL 成功メッセージを表示し、アーティスト一覧を更新する
4. IF APIが409 Conflictを返したとき、THEN THE システム SHALL 同じartistNameを持つアーティストレコードが既に存在することを示すエラーメッセージを表示する
5. IF APIが400 Bad Requestを返したとき、THEN THE システム SHALL 各無効なフィールドに対する検証エラーメッセージを表示する
6. THE アーティストフォーム SHALL 送信前にartistNameフィールドが空でないことを検証する
7. THE アーティストフォーム SHALL artistNameフィールドが1文字以上50文字以下であることを検証する
8. THE アーティストフォーム SHALL unitNameフィールドが入力されている場合、1文字以上25文字以下であることを検証する
9. THE アーティストフォーム SHALL contentフィールドが入力されている場合、1文字以上20文字以下であることを検証する

### 要件11: アーティスト情報編集

**ユーザーストーリー:** ユーザーとして、既存のアーティストレコードを編集したい。そうすることで、誤った情報や古い情報を更新できる。

#### 受入基準

1. WHEN ユーザーがアーティストレコードの「編集」ボタンをクリックしたとき、THE システム SHALL 現在のレコードデータが事前入力されたアーティストフォームを表示する
2. WHEN ユーザーが編集したフォームを送信したとき、THE APIクライアント SHALL 更新されたデータを含むPUTリクエストを /artists/{id} に送信する
3. IF APIが200 OKを返したとき、THEN THE システム SHALL 成功メッセージを表示し、アーティスト一覧を更新する
4. IF APIが404 Not Foundを返したとき、THEN THE システム SHALL アーティストレコードが存在しないことを示すエラーメッセージを表示する
5. IF APIが409 Conflictを返したとき、THEN THE システム SHALL 同じartistNameを持つ別のアーティストレコードが既に存在することを示すエラーメッセージを表示する
6. IF APIが400 Bad Requestを返したとき、THEN THE システム SHALL 各無効なフィールドに対する検証エラーメッセージを表示する

### 要件12: アーティスト削除

**ユーザーストーリー:** ユーザーとして、アーティストレコードを削除したい。そうすることで、不要になったアーティストを削除できる。

#### 受入基準

1. WHEN ユーザーがアーティストレコードの「削除」ボタンをクリックしたとき、THE システム SHALL 確認ダイアログを表示する
2. THE 確認ダイアログ SHALL アーティストを削除すると楽曲から参照されているアーティストが不明なアーティストとして扱われることを警告する
3. WHEN ユーザーが削除を確認したとき、THE APIクライアント SHALL DELETEリクエストを /artists/{id} に送信する
4. IF APIが204 No Contentを返したとき、THEN THE システム SHALL 成功メッセージを表示し、アーティスト一覧を更新する
5. IF APIが404 Not Foundを返したとき、THEN THE システム SHALL アーティストレコードが存在しないことを示すエラーメッセージを表示する
6. WHEN ユーザーが確認ダイアログで削除をキャンセルしたとき、THE システム SHALL 変更を加えずにダイアログを閉じる

### 要件13: ナビゲーション

**ユーザーストーリー:** ユーザーとして、楽曲管理ページとアーティスト管理ページの間を簡単に移動したい。そうすることで、効率的に両方のデータを管理できる。

#### 受入基準

1. THE システム SHALL 楽曲一覧とアーティスト一覧を切り替えるナビゲーションメニューを提供する
2. WHEN ユーザーがナビゲーションメニューで「楽曲管理」をクリックしたとき、THE システム SHALL 楽曲一覧ページを表示する
3. WHEN ユーザーがナビゲーションメニューで「アーティスト管理」をクリックしたとき、THE システム SHALL アーティスト一覧ページを表示する
4. THE ナビゲーションメニュー SHALL 現在表示中のページを視覚的に示す
5. THE システム SHALL すべてのページで一貫したナビゲーションメニューを表示する
